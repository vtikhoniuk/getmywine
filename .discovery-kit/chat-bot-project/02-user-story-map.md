# User Story Map: NutriBot

> **Версия:** 1.0
> **Дата:** 2026-01-30
> **Основано на:** Brief v1.0

---

## Backbone (Путь пользователя)

```
[Онбординг] → [Сбор анамнеза] → [Рекомендации] → [Загрузка анализов] → [Отчёт] → [Работа с клиентом]
```

### Роли
- **Клиент** — пользователь Telegram-бота, клиент нутрициолога
- **Нутрициолог** — специалист, использующий веб-панель
- **Система** — автоматические действия бота и бэкенда

---

## Release 1.0 (MVP)

### [EPIC-001] Онбординг клиента
---

**[US-001][Клиент] Как клиент, я хочу начать диалог с ботом по ссылке от нутрициолога, чтобы пройти первичный опрос.**
- [ ] AC 1: Клиент получает уникальную ссылку на бота от нутрициолога
- [ ] AC 2: При старте бот приветствует и объясняет процесс
- [ ] AC 3: Бот показывает disclaimer о том, что это не медицинская консультация
- [ ] AC 4: Клиент подтверждает согласие на обработку данных
- Notes: Ссылка содержит referral-код нутрициолога

---

**[US-002][Клиент] Как клиент, я хочу представиться боту, чтобы он знал мои базовые данные.**
- [ ] AC 1: Бот запрашивает имя
- [ ] AC 2: Бот запрашивает возраст
- [ ] AC 3: Бот запрашивает пол
- [ ] AC 4: Бот запрашивает рост и вес
- [ ] AC 5: Данные сохраняются в профиле клиента
- Notes: Возможность пропустить вес (чувствительная тема)

---

**[SS-001][Система] Как система, я хочу создать карточку клиента и привязать к нутрициологу, чтобы специалист видел нового клиента.**
- [ ] AC 1: Создаётся запись клиента в базе
- [ ] AC 2: Клиент привязывается к нутрициологу по referral-коду
- [ ] AC 3: Нутрициолог получает уведомление о новом клиенте
- Notes: Push/email нутрициологу

---

### [EPIC-002] Сбор анамнеза
---

**[US-003][Клиент] Как клиент, я хочу ответить на вопросы о своих целях, чтобы бот понял, чего я хочу достичь.**
- [ ] AC 1: Бот предлагает выбор целей (похудение, набор массы, здоровье, энергия, спорт)
- [ ] AC 2: Можно выбрать несколько целей
- [ ] AC 3: Бот уточняет приоритетную цель
- [ ] AC 4: Для каждой цели задаются уточняющие вопросы
- Notes: Вопросы адаптируются под выбранные цели

---

**[US-004][Клиент] Как клиент, я хочу рассказать о своих пищевых привычках, чтобы бот понял мой текущий рацион.**
- [ ] AC 1: Бот спрашивает о количестве приёмов пищи
- [ ] AC 2: Бот спрашивает о типичном завтраке/обеде/ужине
- [ ] AC 3: Бот спрашивает о перекусах
- [ ] AC 4: Бот спрашивает о потреблении воды
- [ ] AC 5: Бот спрашивает о частых продуктах и блюдах
- Notes: Свободный текст обрабатывается LLM

---

**[US-005][Клиент] Как клиент, я хочу указать свои ограничения и предпочтения, чтобы бот учёл их в рекомендациях.**
- [ ] AC 1: Бот спрашивает об аллергиях
- [ ] AC 2: Бот спрашивает о непереносимости (лактоза, глютен)
- [ ] AC 3: Бот спрашивает о предпочтениях (вегетарианство, веганство)
- [ ] AC 4: Бот спрашивает о религиозных ограничениях (халяль, кошер)
- [ ] AC 5: Бот спрашивает о нелюбимых продуктах
- Notes: Важно для safety — аллергии критичны

---

**[US-006][Клиент] Как клиент, я хочу рассказать о состоянии здоровья, чтобы нутрициолог понимал контекст.**
- [ ] AC 1: Бот спрашивает о хронических заболеваниях
- [ ] AC 2: Бот спрашивает о текущих симптомах (усталость, проблемы с ЖКТ, кожа)
- [ ] AC 3: Бот спрашивает о принимаемых лекарствах
- [ ] AC 4: Бот спрашивает о БАДах и витаминах
- [ ] AC 5: Бот отмечает red flags для срочного внимания нутрициолога
- Notes: Red flags: диабет, заболевания почек, беременность

---

**[US-007][Клиент] Как клиент, я хочу рассказать о своём образе жизни, чтобы бот учёл контекст.**
- [ ] AC 1: Бот спрашивает об уровне физической активности
- [ ] AC 2: Бот спрашивает о качестве сна
- [ ] AC 3: Бот спрашивает об уровне стресса
- [ ] AC 4: Бот спрашивает о режиме работы
- Notes: Влияет на рекомендации по режиму питания

---

**[SS-002][Система] Как система, я хочу извлечь структурированные данные из ответов клиента, чтобы сформировать профиль.**
- [ ] AC 1: LLM анализирует свободный текст и извлекает сущности
- [ ] AC 2: Извлечённые данные структурируются по категориям
- [ ] AC 3: Система определяет пробелы в информации
- [ ] AC 4: Система подсвечивает red flags
- Notes: Использование Claude/GPT с structured output

---

### [EPIC-003] Рекомендации по анализам
---

**[US-008][Клиент] Как клиент, я хочу получить список рекомендуемых анализов, чтобы понимать, что сдавать.**
- [ ] AC 1: Бот показывает список анализов с пояснениями
- [ ] AC 2: Анализы разделены на обязательные и опциональные
- [ ] AC 3: Для каждого анализа указано, зачем он нужен
- [ ] AC 4: Бот может показать примерную стоимость
- Notes: Список зависит от целей и анамнеза

---

**[SS-003][Система] Как система, я хочу сформировать персонализированный список анализов на основе анамнеза, чтобы рекомендации были релевантными.**
- [ ] AC 1: Базовый набор анализов для всех (ОАК, биохимия, гормоны щитовидной)
- [ ] AC 2: Дополнительные анализы в зависимости от целей
- [ ] AC 3: Дополнительные анализы в зависимости от симптомов
- [ ] AC 4: Учёт противопоказаний и ограничений
- Notes: Правила формируются совместно с нутрициологом

---

**[US-009][Клиент] Как клиент, я хочу получить инструкцию по подготовке к анализам, чтобы результаты были точными.**
- [ ] AC 1: Бот показывает общие правила (натощак, без алкоголя)
- [ ] AC 2: Для специфических анализов — отдельные инструкции
- [ ] AC 3: Бот напоминает за день до сдачи (если указана дата)
- Notes: Важно для качества результатов

---

### [EPIC-004] Загрузка и обработка анализов
---

**[US-010][Клиент] Как клиент, я хочу загрузить результаты анализов фото или PDF, чтобы бот их обработал.**
- [ ] AC 1: Бот принимает фото результатов
- [ ] AC 2: Бот принимает PDF-файлы
- [ ] AC 3: Бот подтверждает получение
- [ ] AC 4: Бот показывает статус обработки
- Notes: Поддержка нескольких файлов за раз

---

**[SS-004][Система] Как система, я хочу распознать данные из анализов, чтобы структурировать их для отчёта.**
- [ ] AC 1: OCR распознаёт текст из изображений/PDF
- [ ] AC 2: LLM извлекает показатели и значения
- [ ] AC 3: Показатели сопоставляются с референсными значениями
- [ ] AC 4: Выделяются отклонения от нормы
- [ ] AC 5: Результаты сохраняются в профиле клиента
- Notes: Fallback: ручной ввод при ошибке распознавания

---

**[US-011][Клиент] Как клиент, я хочу увидеть подтверждение распознанных данных, чтобы исправить ошибки.**
- [ ] AC 1: Бот показывает распознанные показатели
- [ ] AC 2: Клиент может подтвердить или исправить
- [ ] AC 3: Бот подсвечивает неуверенные значения
- Notes: Критично для точности

---

**[US-012][Клиент] Как клиент, я хочу ввести результаты анализов вручную, если автоматическое распознавание не сработало.**
- [ ] AC 1: Бот предлагает режим ручного ввода
- [ ] AC 2: Бот запрашивает значения ключевых показателей
- [ ] AC 3: Бот валидирует введённые значения (разумные диапазоны)
- Notes: Fallback для сложных форматов

---

### [EPIC-005] Генерация отчёта
---

**[SS-005][Система] Как система, я хочу сгенерировать черновик отчёта на основе всех данных, чтобы помочь нутрициологу.**
- [ ] AC 1: Сводка по клиенту (демография, цели, анамнез)
- [ ] AC 2: Анализ результатов с интерпретацией
- [ ] AC 3: Выявленные паттерны и взаимосвязи
- [ ] AC 4: Предварительные рекомендации
- [ ] AC 5: Вопросы для дополнительного уточнения
- [ ] AC 6: Red flags и зоны внимания
- Notes: LLM генерирует, нутрициолог проверяет и корректирует

---

**[SS-006][Система] Как система, я хочу уведомить нутрициолога о готовности отчёта, чтобы он мог начать работу.**
- [ ] AC 1: Push-уведомление или email нутрициологу
- [ ] AC 2: Указание срочности (есть red flags или нет)
- [ ] AC 3: Ссылка на карточку клиента
- Notes: Разные каналы уведомлений

---

### [EPIC-006] Работа нутрициолога с клиентом
---

**[US-013][Нутрициолог] Как нутрициолог, я хочу видеть список своих клиентов, чтобы управлять своей практикой.**
- [ ] AC 1: Список клиентов с фильтрацией (новые, активные, завершённые)
- [ ] AC 2: Поиск по имени
- [ ] AC 3: Сортировка по дате, статусу
- [ ] AC 4: Индикаторы новых данных/отчётов
- Notes: Веб-панель

---

**[US-014][Нутрициолог] Как нутрициолог, я хочу видеть полную карточку клиента, чтобы понимать его ситуацию.**
- [ ] AC 1: Демографические данные
- [ ] AC 2: Цели и приоритеты
- [ ] AC 3: Анамнез (питание, здоровье, образ жизни)
- [ ] AC 4: Результаты анализов с подсветкой отклонений
- [ ] AC 5: История взаимодействий
- Notes: Единая точка всей информации

---

**[US-015][Нутрициолог] Как нутрициолог, я хочу просмотреть и отредактировать отчёт, чтобы подготовить рекомендации.**
- [ ] AC 1: Просмотр сгенерированного отчёта
- [ ] AC 2: Редактирование любых секций
- [ ] AC 3: Добавление собственных комментариев
- [ ] AC 4: Сохранение версий
- Notes: WYSIWYG редактор

---

**[US-016][Нутрициолог] Как нутрициолог, я хочу экспортировать отчёт в PDF, чтобы отправить клиенту.**
- [ ] AC 1: Генерация красивого PDF
- [ ] AC 2: Брендирование (логотип нутрициолога)
- [ ] AC 3: Скачивание или отправка клиенту через бота
- Notes: Шаблон PDF настраиваемый

---

**[US-017][Нутрициолог] Как нутрициолог, я хочу отправить отчёт клиенту через бота, чтобы клиент получил результат.**
- [ ] AC 1: Нажатие кнопки "Отправить клиенту"
- [ ] AC 2: Клиент получает PDF в Telegram
- [ ] AC 3: Бот предлагает записаться на консультацию
- Notes: Замыкание цикла

---

### [EPIC-007] Аутентификация и безопасность
---

**[US-018][Нутрициолог] Как нутрициолог, я хочу войти в систему, чтобы получить доступ к своим клиентам.**
- [ ] AC 1: Вход по email/паролю
- [ ] AC 2: Опционально: вход через Google/Яндекс
- [ ] AC 3: Восстановление пароля
- Notes: Стандартный auth flow

---

**[US-019][Нутрициолог] Как нутрициолог, я хочу настроить свой профиль, чтобы клиенты видели мою информацию.**
- [ ] AC 1: Имя и фото
- [ ] AC 2: Контактные данные
- [ ] AC 3: Специализация
- [ ] AC 4: Настройки уведомлений
- Notes: Профиль виден клиенту в боте

---

**[SS-007][Система] Как система, я хочу защитить данные клиентов, чтобы соответствовать требованиям 152-ФЗ.**
- [ ] AC 1: Шифрование данных при хранении
- [ ] AC 2: HTTPS для всех соединений
- [ ] AC 3: Логирование доступа к данным
- [ ] AC 4: Возможность удаления данных клиента по запросу
- Notes: Обязательно для медицинских данных

---

## Release 1.1

### [EPIC-001] Онбординг (расширение)
---

**[US-020][Клиент] Как клиент, я хочу продолжить заполнение анкеты позже, чтобы не заполнять всё за один раз.**
- [ ] AC 1: Бот сохраняет прогресс
- [ ] AC 2: Бот напоминает через 24 часа
- [ ] AC 3: Можно начать с места остановки
- Notes: Длинная анкета — барьер

---

**[US-021][Нутрициолог] Как нутрициолог, я хочу кастомизировать вопросы бота, чтобы адаптировать под свою методологию.**
- [ ] AC 1: Включение/выключение блоков вопросов
- [ ] AC 2: Добавление собственных вопросов
- [ ] AC 3: Изменение порядка вопросов
- Notes: Дифференциация для premium-тарифа

---

### [EPIC-008] Повторные визиты
---

**[US-022][Клиент] Как клиент, я хочу загрузить новые анализы после начала работы с нутрициологом, чтобы отслеживать динамику.**
- [ ] AC 1: Бот распознаёт повторного клиента
- [ ] AC 2: Бот предлагает загрузить новые анализы
- [ ] AC 3: Система сравнивает с предыдущими результатами
- Notes: Важно для retention

---

**[US-023][Нутрициолог] Как нутрициолог, я хочу видеть динамику показателей клиента, чтобы оценить эффективность.**
- [ ] AC 1: Графики изменения ключевых показателей
- [ ] AC 2: Сравнение "было/стало"
- [ ] AC 3: Автоматические выводы о тренде
- Notes: Визуализация прогресса

---

## Gap Analysis & Risks

### Пропущенные функции

| Функция | Статус | Обоснование |
|---------|--------|-------------|
| Интеграция с лабораториями | Отложено на v2.0 | Сложная интеграция, не критично для MVP |
| Планы питания | Отложено на v2.0 | Отдельный большой модуль |
| Мобильное приложение | Отложено | Telegram достаточен для MVP |
| Онлайн-оплата консультаций | Отложено | Нутрициолог сам решает вопросы оплаты |

### Открытые вопросы

1. Как обрабатывать анализы из разных лабораторий с разными форматами?
2. Нужна ли верификация нутрициологов при регистрации?
3. Как разделять доступ, если у клиента несколько нутрициологов?

### Риски

| # | Риск | Влияние | Митигация |
|---|------|---------|-----------|
| 1 | [⚠️ Risk] Низкое качество OCR для рукописных анализов | Высокое | Приоритет на PDF, ручной ввод как fallback |
| 2 | [⚠️ Risk] LLM-галлюцинации в интерпретации | Критическое | Чёткие промпты, проверка нутрициологом, disclaimer |
| 3 | [⚠️ Risk] Клиенты не доходят до загрузки анализов | Среднее | Напоминания, упрощение процесса |
