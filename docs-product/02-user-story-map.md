# User Story Map: GetMyWine

> **Версия:** 1.4
> **Дата:** 2026-02-10
> **Основано на:** Brief v1.0

---

## Backbone (Путь пользователя)

```
[Знакомство] → [Изучение вкуса] → [Рекомендации] → [История сессий] → [Развитие профиля]
```

### Роли
- **Пользователь** — человек, который хочет разобраться в вине и получать персональные рекомендации
- **Система** — GetMyWine и бэкенд

---

## Release 1.0 (MVP)

### [EPIC-001] Регистрация и онбординг
---

**[US-001][Пользователь] Как пользователь, я хочу зарегистрироваться в сервисе, чтобы мой профиль сохранялся между сессиями.**
- [x] AC 1: Пользователь может зарегистрироваться по email и паролю
- [x] AC 2: Пользователь получает подтверждение email
- [x] AC 3: Пользователь может войти в систему
- [x] AC 4: Возможность восстановить пароль
- Notes: Минимальная регистрация, без социальных сетей в MVP

---

**[US-002][Пользователь] Как пользователь, я хочу увидеть приветствие и понять, что сервис может для меня сделать.**
- [x] AC 1: При первом входе отображается приветственное сообщение
- [x] AC 2: AI объясняет свои возможности простым языком
- [x] AC 3: AI предлагает начать с определения вкусовых предпочтений
- [x] AC 4: AI проактивно предлагает 3 вина на основе контекста (сезон, праздники, день недели)
- Notes: Тёплый, дружелюбный тон без снобизма

---

**[US-003][Пользователь] Как пользователь, я хочу подтвердить, что мне есть 18 лет, чтобы пользоваться сервисом.**
- [x] AC 1: Пользователь видит disclaimer о возрастном ограничении
- [x] AC 2: Пользователь подтверждает возраст
- [x] AC 3: Без подтверждения доступ к сервису заблокирован
- Notes: Реализовано через чекбокс 18+ при регистрации

---

### [EPIC-002] Изучение вкусового профиля
---

**[US-004][Пользователь] Как пользователь, я хочу пропустить первоначальный опрос, чтобы сразу начать пользоваться сервисом.**
- [x] AC 1: При начале онбординга есть кнопка "Пропустить"
- [x] AC 2: При пропуске создаётся пустой профиль
- [x] AC 3: AI предупреждает, что рекомендации будут менее точными
- [x] AC 4: Пользователь может пройти опрос позже в любой момент
- Notes: Снижает барьер входа. Профиль будет формироваться из диалогов.

---

**[US-005][Пользователь] Как пользователь, я хочу рассказать AI о своих предпочтениях, чтобы он понял мой вкус.**
- [ ] AC 1: AI задаёт вопросы о вкусовых предпочтениях (сладкое/сухое, лёгкое/насыщенное)
- [ ] AC 2: AI спрашивает об опыте с вином (новичок/любитель/знаток)
- [ ] AC 3: AI узнаёт о любимых и нелюбимых продуктах (фрукты, специи, шоколад)
- [ ] AC 4: AI может предложить варианты ответов, если пользователь затрудняется
- Notes: Диалог, не анкета — дружеский разговор

---

**[US-006][Пользователь] Как пользователь, я хочу рассказать о запомнившихся винах, чтобы AI понял, что мне нравится.**
- [ ] AC 1: Пользователь может описать вино словами ("красное из Италии, пили на отпуске")
- [ ] AC 2: AI извлекает характеристики из описания
- [ ] AC 3: AI уточняет детали, если описание неполное
- [ ] AC 4: AI фиксирует впечатление (понравилось / не понравилось / не помню)
- Notes: Важно понимать контекст — с чем пили, по какому случаю

---

**[US-007][Пользователь] Как пользователь, я хочу указать свой бюджет на вино, чтобы рекомендации были реалистичными.**
- [ ] AC 1: AI спрашивает типичный бюджет на бутылку
- [ ] AC 2: Пользователь выбирает диапазон (до 500₽, 500-1000₽, 1000-2000₽, 2000-5000₽, 5000₽+)
- [ ] AC 3: Бюджет можно изменить в любой момент
- Notes: Бюджет влияет на рекомендации, но не ограничивает их жёстко

---

**[SS-001][Система] Как система, я хочу сформировать вкусовой профиль пользователя на основе диалога.**
- [ ] AC 1: Система извлекает структурированные предпочтения из свободного текста
- [ ] AC 2: Профиль включает: сладость, кислотность, танины, тело, ароматы
- [ ] AC 3: Профиль обновляется после каждого взаимодействия
- [ ] AC 4: Система оценивает "уверенность" в каждом параметре профиля
- Notes: Использование LLM для NLU

---

### [EPIC-003] Рекомендации вин
---

**[US-008][Пользователь] Как пользователь, я хочу задать вопрос о вине в свободной форме, чтобы получить рекомендацию.**
- [x] AC 1: Строка ввода для свободного текста
- [x] AC 2: AI понимает разные формулировки ("что взять к стейку", "хочу лёгкое белое", "посоветуй что-нибудь новое")
- [x] AC 3: AI отвечает на языке пользователя, без снобизма
- [x] AC 4: AI рекомендует конкретные вина из каталога
- [x] AC 5: AI учитывает историю диалога (до 10 сообщений)
- Notes: Ключевая функция MVP

---

**[US-009][Пользователь] Как пользователь, я хочу видеть персонализированные подсказки, чтобы не думать, что спросить.**
- [x] AC 1: Отображаются 1-3 подсказки на основе профиля
- [x] AC 2: Подсказки меняются со временем (новые идеи)
- [x] AC 3: Подсказки учитывают сезон, события, историю
- [ ] AC 4: Клик на подсказку = отправка запроса
- Notes: Примеры: "Лучший пино нуар 2025", "Вино для романтического ужина", "Попробуй что-то новое"

---

**[US-010][Пользователь] Как пользователь, я хочу понять, почему AI рекомендует именно это вино.**
- [x] AC 1: Для каждой рекомендации показано обоснование
- [x] AC 2: Обоснование связано с профилем пользователя ("Вам понравится, потому что вы любите...")
- [x] AC 3: Указаны ключевые характеристики вина на понятном языке
- [x] AC 4: Показаны вкусовые ноты и с чем сочетается
- Notes: Образовательный момент — пользователь учится понимать вино

---

**[SS-002][Система] Как система, я хочу рекомендовать только вина из каталога, чтобы не галлюцинировать.**
- [x] AC 1: AI ищет вина в каталоге по характеристикам
- [x] AC 2: AI не выдумывает несуществующие вина
- [x] AC 3: Если подходящего вина нет — честно говорит об этом
- [x] AC 4: Использование RAG для поиска по каталогу
- Notes: Критично для доверия

---

**[US-011][Пользователь] Как пользователь, я хочу видеть информацию о рекомендованном вине.**
- [x] AC 1: Название, регион, сорт винограда
- [x] AC 2: Год урожая (если релевантно)
- [x] AC 3: Вкусовые характеристики (описание)
- [x] AC 4: Ориентировочная цена
- [x] AC 5: Изображение бутылки вина
- Notes: Информация из каталога. Изображения хранятся локально и отдаются через /static/images/wines/

---

### [EPIC-004] Управление профилем
---

**[US-012][Пользователь] Как пользователь, я хочу дать обратную связь на рекомендацию, чтобы AI учился.**
- [ ] AC 1: Возможность отметить "Попробовал, понравилось"
- [ ] AC 2: Возможность отметить "Попробовал, не понравилось"
- [ ] AC 3: AI благодарит за обратную связь и обновляет профиль
- Notes: Улучшает качество рекомендаций

---

**[SS-003][Система] Как система, я хочу обновлять профиль на основе обратной связи.**
- [ ] AC 1: Положительная обратная связь усиливает связанные характеристики
- [ ] AC 2: Отрицательная обратная связь ослабляет связанные характеристики
- [ ] AC 3: Система логирует все изменения профиля
- Notes: Основа для улучшения персонализации

---

### [EPIC-005] Каталог вин
---

**[SS-004][Система] Как система, я хочу хранить каталог вин с характеристиками, чтобы давать точные рекомендации.**
- [x] AC 1: Минимум 50 вин в каталоге
- [x] AC 2: Для каждого вина: название, производитель, регион, сорт, год
- [x] AC 3: Вкусовые характеристики: сладость, кислотность, танины, тело
- [x] AC 4: Описание, вкусовые ноты
- [x] AC 5: Ценовой диапазон
- Notes: Ручное наполнение на старте

---

**[SS-005][Система] Как система, я хочу искать вина по характеристикам, чтобы быстро находить подходящие.**
- [x] AC 1: Поиск по типу (красное, белое, розовое, игристое)
- [x] AC 2: Поиск по ценовому диапазону
- [x] AC 3: Поиск по вкусовым характеристикам
- [x] AC 4: Семантический поиск по описанию
- Notes: Основа для RAG

---

**[SS-007][Система] Как система, я хочу иметь предзаполненный каталог из 50 вин, чтобы сразу давать рекомендации.**
- [x] AC 1: Каталог содержит минимум 50 вин из открытых источников
- [x] AC 2: Для каждого вина загружено изображение бутылки
- [x] AC 3: Цены агрегированы из нескольких источников (используется средняя)
- [x] AC 4: Разнообразие по типу: красное (~40%), белое (~30%), розовое (~15%), игристое (~15%)
- [x] AC 5: Разнообразие по вкусу: сухие, полусухие, полусладкие, сладкие
- [x] AC 6: Разнообразие по телу: лёгкие, средние, полнотелые
- [x] AC 7: Разнообразие по регионам: Франция, Италия, Испания, Чили, Аргентина, Россия и др.
- [x] AC 8: Ценовой диапазон: бюджет (<1500₽), мид (1500-5000₽), премиум (>5000₽)
- [x] AC 9: Подборка покрывает типичные случаи: к мясу, рыбе, сыру, десертам, для праздника
- Notes: Данные из SimpleWine. 50 PNG-изображений бутылок хранятся в backend/app/static/images/wines/

---

### [EPIC-006] Безопасность и данные
---

**[SS-006][Система] Как система, я хочу защитить данные пользователей.**
- [x] AC 1: Пароли хранятся в захешированном виде
- [ ] AC 2: HTTPS для всех соединений
- [x] AC 3: Данные хранятся в РФ (152-ФЗ)
- [x] AC 4: Возможность удалить аккаунт и все данные
- Notes: Базовые требования безопасности

---

## Release 1.1

### [EPIC-007] Расширение каталога
---

**[US-014][Пользователь] Как пользователь, я хочу искать конкретное вино в каталоге, чтобы узнать о нём больше.**
- [ ] AC 1: Поиск по названию
- [ ] AC 2: Отображение карточки вина
- [ ] AC 3: AI комментирует, насколько вино подходит профилю
- Notes: Дополнительная ценность

---

**[US-015][Пользователь] Как пользователь, я хочу сохранять понравившиеся вина в избранное.**
- [ ] AC 1: Кнопка "Добавить в избранное"
- [ ] AC 2: Список избранного в профиле
- [ ] AC 3: Возможность убрать из избранного
- Notes: Персональная коллекция

---

### [EPIC-008] Контекстные рекомендации
---

**[US-016][Пользователь] Как пользователь, я хочу получить рекомендацию под конкретное блюдо.**
- [x] AC 1: Пользователь описывает блюдо
- [x] AC 2: AI подбирает вино, которое сочетается
- [x] AC 3: AI объясняет, почему это сочетание работает
- Notes: Классический use case

---

**[US-017][Пользователь] Как пользователь, я хочу получить рекомендацию под событие.**
- [x] AC 1: Пользователь описывает событие (день рождения, романтический ужин, BBQ)
- [x] AC 2: AI учитывает контекст и компанию
- [x] AC 3: AI может предложить несколько вариантов для разных гостей
- Notes: Социальный контекст важен

---

### [EPIC-009] Проактивные рекомендации
---

**[SS-008][Система] Как система, я хочу учитывать реальные события и праздники при рекомендациях.**
- [x] AC 1: Система знает о российских праздниках
- [x] AC 2: За 7 дней до праздника включается тематическая рекомендация
- [x] AC 3: В день праздника рекомендация выделяется особо
- [x] AC 4: Каждый праздник имеет рекомендуемый стиль вина
- Notes: Новый год, 23 февраля, 8 марта, День Победы, День России

---

**[SS-009][Система] Как система, я хочу сохранять историю диалога для контекста.**
- [x] AC 1: Последние 10 сообщений передаются в LLM
- [x] AC 2: Welcome-сообщения исключаются из истории
- [x] AC 3: История сохраняется в БД
- Notes: Улучшает качество рекомендаций в диалоге

---

### [EPIC-010] История сессий
---

**[US-018][Пользователь] Как пользователь, я хочу видеть историю своих прошлых диалогов, чтобы вернуться к интересным рекомендациям.**
- [x] AC 1: В боковом меню отображается список прошлых сессий
- [x] AC 2: Каждая сессия имеет краткое название (1-3 слова)
- [x] AC 3: Сессии отсортированы по дате (новые сверху)
- [x] AC 4: При клике на сессию открывается история диалога
- [x] AC 5: История доступна только для чтения (нельзя продолжить старый диалог)
- Notes: UX аналогичен ChatGPT, Claude, Gemini

---

**[US-019][Пользователь] Как пользователь, я хочу начинать новый диалог при каждом входе, чтобы получать свежие рекомендации.**
- [x] AC 1: При новом входе автоматически создаётся новая сессия
- [x] AC 2: Новая сессия начинается с приветствия и рекомендаций на основе истории пользователя (или общего контекста для новых пользователей)
- [x] AC 3: Кнопка "Новый диалог" доступна в любой момент
- [x] AC 4: Переход на новый диалог не удаляет текущую сессию
- Notes: Приветствие персонализировано: учитывает прошлые сессии, если они есть

---

**[SS-010][Система] Как система, я хочу автоматически генерировать название сессии, чтобы пользователь мог быстро найти нужный диалог.**
- [x] AC 1: Название генерируется после первого ответа AI
- [x] AC 2: Название отражает ключевую тему: вино, событие или блюдо
- [x] AC 3: Примеры названий: "Вино к стейку", "Бордо на ДР", "Розовое для пикника"
- [x] AC 4: Название не превышает 30 символов
- [x] AC 5: Если тема неясна — используется дата ("3 февраля")
- Notes: LLM генерирует название на основе первых сообщений

---

**[SS-011][Система] Как система, я хочу учитывать историю всех сессий пользователя при генерации рекомендаций.**
- [x] AC 1: Система извлекает ключевые факты из прошлых сессий (понравившиеся вина, события)
- [x] AC 2: Факты передаются в LLM как часть контекста пользователя
- [x] AC 3: AI не повторяет одни и те же рекомендации в разных сессиях
- [x] AC 4: AI может сослаться на прошлый опыт ("В прошлый раз вам понравилось...")
- Notes: Долгосрочная персонализация через историю

---

**[SS-012][Система] Как система, я хочу управлять жизненным циклом сессий.**
- [x] AC 1: Сессия автоматически закрывается через 30 минут неактивности
- [x] AC 2: Сессии хранятся минимум 90 дней
- [x] AC 3: Пользователь может удалить отдельную сессию
- [x] AC 4: При удалении аккаунта удаляются все сессии
- Notes: Баланс между историей и приватностью

---

### [EPIC-011] Telegram-бот
---

**[US-020][Пользователь] Как пользователь, я хочу общаться с GetMyWine через Telegram, чтобы получать рекомендации в привычном мессенджере.**
- [ ] AC 1: Пользователь может найти бота в Telegram по имени
- [ ] AC 2: В описании бота указано, что при нажатии /start пользователь подтверждает, что ему есть 18 лет
- [x] AC 3: Бот отвечает на команду /start приветственным сообщением
- [x] AC 4: Приветственное сообщение содержит краткое описание возможностей бота и 3 рекомендации на основе контекста пользователя как и в веб-версии
- [x] AC 5: Каждая рекомендация в приветствии сопровождается фотографией бутылки вина
- [ ] AC 6: Бот работает с тем же профилем пользователя, что и веб-версия
- Notes: Единая точка входа для пользователей мессенджеров. Приветствие: вводное сообщение → 3 вина с фото → завершающий вопрос.

---

**[US-021][Пользователь] Как пользователь, я хочу получать рекомендации вин через Telegram так же, как в веб-версии.**
- [x] AC 1: Бот принимает свободные текстовые запросы о вине
- [x] AC 2: Бот рекомендует вина из каталога с обоснованием
- [ ] AC 3: Бот учитывает профиль пользователя при рекомендациях
- [x] AC 4: Бот может рекомендовать вина под блюдо или событие
- [ ] AC 5: Бот отображает персонализированные подсказки для запросов
- [x] AC 6: Каждая рекомендация сопровождается фотографией бутылки вина
- [x] AC 7: Ответ бота структурирован как 5 сообщений: контекст запроса → 3 вина с фото → завершающий вопрос
- [x] AC 8: Первое сообщение содержит краткое описание контекста запроса без повторного приветствия (для возвращающихся пользователей)
- Notes: Функциональность идентична веб-версии. Каждое вино — отдельное фото-сообщение. Формат ответа: 5 сообщений (контекст → вино 1 → вино 2 → вино 3 → уточняющий вопрос).

---

**[US-022][Пользователь] Как пользователь, я хочу видеть информацию о вине в удобном формате в Telegram.**
- [x] AC 1: Информация о вине отображается структурированно (название, регион, сорт, год)
- [x] AC 2: Вкусовые характеристики и описание читаемы в мобильном формате
- [x] AC 3: Цена показана в понятном виде
- [x] AC 4: Обоснование рекомендации выделено отдельно
- [x] AC 5: Каждая рекомендация отправляется отдельным сообщением с фотографией бутылки вина
- [x] AC 6: Ответ бота структурирован как 5 сообщений: вводное → 3 вина с фото → завершающее
- [x] AC 7: Подпись к фото — простой текст (без разметки): название вина, регион/страна, сорт винограда, тип (сухое/полусухое и т.д.), цена в рублях
- [x] AC 8: Подпись к фото не превышает 1024 символа; при превышении обрезается с сохранением названия и цены
- [x] AC 9: Фотографии бутылок загружаются из базы данных вин (добавлены при первоначальной загрузке каталога)
- [x] AC 10: Если у вина нет изображения — рекомендация отправляется как текстовое сообщение вместо фото
- [x] AC 11: Если структурированный ответ не удалось разобрать — бот отправляет единое текстовое сообщение и отдельные фото упомянутых вин (fallback)
- [x] AC 12: При нахождении менее 3 вин бот отправляет сообщения только для найденных вин, сохраняя вводное и завершающее
- Notes: Каждое вино — отдельное фото-сообщение с описанием в caption (plain text). Вводное и завершающее — текстовые сообщения с базовым форматированием. Порядок строго последовательный: intro → вино 1 → вино 2 → вино 3 → closing.

---

**[US-023][Пользователь] Как пользователь, я хочу управлять профилем через Telegram.**
- [ ] AC 1: Команда для просмотра текущего профиля
- [ ] AC 2: Возможность обновить вкусовые предпочтения
- [ ] AC 3: Возможность изменить бюджет
- [ ] AC 4: Возможность дать обратную связь на рекомендации
- Notes: Основные функции управления профилем доступны в боте

---

**[SS-013][Система] Как система, я хочу использовать единый бэкенд для веб и Telegram бота.**
- [ ] AC 1: Бот и веб используют один API Gateway
- [ ] AC 2: Бот и веб работают с одной БД пользователей
- [ ] AC 3: Бот и веб используют одну логику рекомендаций (LLM + RAG)
- [ ] AC 4: Профиль пользователя синхронизирован между веб и ботом
- Notes: Исключает дублирование кода и данных

---

**[SS-014][Система] Как система, я хочу поддерживать раздельный запуск веб и бота.**
- [ ] AC 1: Telegram-бот может работать независимо от веб-сервера
- [ ] AC 2: Веб-сервер может работать независимо от Telegram-бота
- [ ] AC 3: Оба компонента могут работать одновременно
- [ ] AC 4: Конфигурация запуска управляется переменными окружения
- Notes: Гибкость в деплое — бот на отдельном сервере или вместе с веб

---

**[SS-015][Система] Как система, я хочу обрабатывать команды Telegram бота.**
- [ ] AC 1: /start — приветствие и регистрация с подтверждением возраста 18+
- [ ] AC 2: /help — список доступных команд
- [ ] AC 3: /profile — просмотр вкусового профиля
- [ ] AC 4: Обработка текстовых сообщений для рекомендаций
- Notes: Стандартные команды Telegram ботов. Команда /reset не нужна — пользователь может уточнить запрос обычным сообщением

---

**[SS-016][Система] Как система, я хочу сохранять историю диалога в Telegram боте, но не предоставлять отдельные команды для её отображения.**
- [ ] AC 1: История сообщений в текущей сессии доступна через скролл в Telegram
- [ ] AC 2: Бот сохраняет всю историю диалога в БД (как и веб-версия)
- [ ] AC 3: Бот не предоставляет отдельных команд для просмотра прошлых сессий
- [ ] AC 4: История сессий доступна пользователю через веб-версию
- [ ] AC 5: Контекст текущей сессии учитывается при генерации рекомендаций
- Notes: Формат мессенджера не требует отдельного UI для истории — пользователь может скроллить назад

---

**[SS-017][Система] Как система, я хочу обеспечить безопасную аутентификацию в Telegram боте.**
- [ ] AC 1: При первом /start создаётся аккаунт, привязанный к Telegram ID
- [ ] AC 2: Telegram ID используется как уникальный идентификатор пользователя
- [ ] AC 3: Возможность связать Telegram с существующим email-аккаунтом
- [ ] AC 4: Защита от подмены Telegram ID через верификацию токена
- Notes: Упрощённая аутентификация для мессенджера

---

## Gap Analysis & Risks

### Пропущенные функции

| Функция | Статус | Обоснование |
|---------|--------|-------------|
| Покупка вина | Отложено на v2.0 | Ждём UCP или партнёрства |
| Сканирование этикеток | Отложено на v2.0 | Требует OCR, не критично для MVP |
| Мобильное приложение | Отложено | Веб достаточен для MVP |
| Социальные функции | Отложено | Фокус на персональном опыте |
| ~~Изображения вин~~ | Реализовано | 50 PNG-изображений из SimpleWine, отдаются через статику, отображаются в веб и Telegram |

### Открытые вопросы

1. Какой минимальный набор характеристик нужен для качественного профиля?

### Риски

| # | Риск | Влияние | Митигация |
|---|------|---------|-----------|
| 1 | Персонализация не работает на малых данных | Высокое | Продуманный онбординг, сбор предпочтений |
| 2 | Пользователи не понимают ценность без покупки | Среднее | Фокус на образовательной ценности |
