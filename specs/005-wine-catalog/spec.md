# Feature Specification: Wine Catalog

**Feature Branch**: `005-wine-catalog`
**Created**: 2026-02-03
**Status**: Draft
**Input**: EPIC-005 из User Story Map (SS-004, SS-005, SS-007)

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Хранение каталога вин (Priority: P1)

Система должна хранить структурированный каталог вин с полными характеристиками, чтобы AI-сомелье мог давать точные рекомендации на основе реальных данных.

**Why this priority**: Без каталога невозможны рекомендации — это фундамент всего сервиса.

**Independent Test**: Можно проверить через API: запросить вино по ID и получить все его характеристики.

**Acceptance Scenarios**:

1. **Given** каталог содержит вино, **When** запрашиваю вино по ID, **Then** получаю полную информацию: название, производитель, регион, сорт, год, вкусовые характеристики, описание, цену
2. **Given** каталог пуст, **When** добавляю вино с обязательными полями, **Then** вино сохраняется и доступно для поиска
3. **Given** каталог содержит вина, **When** запрашиваю список всех вин, **Then** получаю пагинированный список с базовой информацией

---

### User Story 2 - Поиск вин по характеристикам (Priority: P1)

Система должна находить вина по различным критериям (тип, цена, вкус, описание), чтобы AI мог подбирать подходящие варианты под запрос пользователя.

**Why this priority**: Поиск критичен для работы RAG — без него AI не сможет находить релевантные вина.

**Independent Test**: Можно проверить через API: отправить поисковый запрос и получить отфильтрованные результаты.

**Acceptance Scenarios**:

1. **Given** каталог содержит красные и белые вина, **When** ищу по типу "красное", **Then** получаю только красные вина
2. **Given** каталог содержит вина разных цен, **When** ищу в диапазоне $50-100, **Then** получаю только вина в этом ценовом диапазоне
3. **Given** каталог содержит вина с разной сладостью, **When** ищу "сухое", **Then** получаю только сухие вина
4. **Given** каталог содержит вина с описаниями, **When** ищу "к стейку", **Then** получаю вина, подходящие к мясу (семантический поиск)

---

### User Story 3 - Предзаполненный каталог (Priority: P2)

При развёртывании системы каталог должен содержать 50 реальных вин с изображениями и актуальными ценами, чтобы сервис был готов к работе сразу.

**Why this priority**: Важно для запуска, но технически можно начать с пустого каталога и заполнить позже.

**Independent Test**: После миграции БД проверить, что в каталоге ровно 50 вин с заполненными полями и изображениями.

**Acceptance Scenarios**:

1. **Given** чистая БД, **When** применяю seed-миграцию, **Then** в каталоге появляется 50 вин
2. **Given** seed применён, **When** проверяю распределение по типам, **Then** ~40% красных, ~30% белых, ~15% розовых, ~15% игристых
3. **Given** seed применён, **When** проверяю цены, **Then** 90% вин в диапазоне $50-100, 10% премиум ($100+)
4. **Given** seed применён, **When** проверяю изображения, **Then** у каждого вина есть URL изображения

---

### Edge Cases

- Что если вино не найдено по ID? → 404 Not Found
- Что если поисковый запрос не даёт результатов? → Пустой список, не ошибка
- Что если семантический поиск не находит релевантных результатов? → Пустой список с suggestion
- Что если изображение вина недоступно? → Показать placeholder
- Что если цена устарела? → Показать "цена может отличаться"

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: Система MUST хранить для каждого вина: название, производитель, регион, страна, сорт винограда, год урожая
- **FR-002**: Система MUST хранить вкусовые характеристики: тип (красное/белое/розовое/игристое), сладость, кислотность, танины, тело (1-5 шкала)
- **FR-003**: Система MUST хранить описание, вкусовые ноты и рекомендации по сочетанию с едой
- **FR-004**: Система MUST хранить ценовой диапазон (min/max или среднюю цену в USD)
- **FR-005**: Система MUST хранить URL изображения бутылки
- **FR-006**: Система MUST поддерживать поиск по типу вина (enum фильтр)
- **FR-007**: Система MUST поддерживать поиск по ценовому диапазону (range фильтр)
- **FR-008**: Система MUST поддерживать поиск по вкусовым характеристикам (multi-filter)
- **FR-009**: Система MUST поддерживать семантический поиск по описанию через pgvector
- **FR-010**: Система MUST содержать минимум 50 вин при первом развёртывании (seed data)

### Key Entities

- **Wine**: Основная сущность — вино с полным набором характеристик
  - Идентификация: id (UUID), name, producer, vintage_year
  - География: country, region, appellation (опционально)
  - Виноград: grape_varieties (массив сортов)
  - Характеристики: wine_type (enum), sweetness, acidity, tannins, body (1-5)
  - Описание: description, tasting_notes, food_pairings
  - Цена: price_usd, price_range (enum: budget/mid/premium)
  - Медиа: image_url
  - Поиск: embedding (vector для pgvector)

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Каталог содержит минимум 50 вин с заполненными обязательными полями
- **SC-002**: Поиск по типу возвращает результаты менее чем за 100ms (p95)
- **SC-003**: Семантический поиск возвращает топ-5 релевантных вин менее чем за 500ms (p95)
- **SC-004**: Все вина имеют валидные URL изображений (200 OK при запросе)
- **SC-005**: Распределение вин соответствует требованиям: 40/30/15/15 по типам, 90/10 по цене
