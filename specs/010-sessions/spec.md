# Feature Specification: Sessions History

**Feature ID**: 010-sessions
**Version**: 1.0
**Date**: 2026-02-03
**Status**: Draft

## Overview

Реализация системы сессий для GetMyWine, позволяющей пользователям иметь несколько диалогов с сомелье, просматривать историю прошлых разговоров и получать персонализированные рекомендации на основе накопленного опыта.

## User Stories

### US-018: Просмотр истории диалогов

**Как** пользователь,
**я хочу** видеть историю своих прошлых диалогов,
**чтобы** вернуться к интересным рекомендациям.

**Acceptance Criteria:**
- [ ] AC 1: В боковом меню отображается список прошлых сессий
- [ ] AC 2: Каждая сессия имеет краткое название (1-3 слова)
- [ ] AC 3: Сессии отсортированы по дате (новые сверху)
- [ ] AC 4: При клике на сессию открывается история диалога
- [ ] AC 5: История доступна только для чтения (нельзя продолжить старый диалог)

**Notes**: UX аналогичен ChatGPT, Claude, Gemini

---

### US-019: Новый диалог при входе

**Как** пользователь,
**я хочу** начинать новый диалог при каждом входе,
**чтобы** получать свежие рекомендации.

**Acceptance Criteria:**
- [ ] AC 1: При новом входе автоматически создаётся новая сессия
- [ ] AC 2: Новая сессия начинается с приветствия и рекомендаций на основе истории пользователя
- [ ] AC 3: Кнопка "Новый диалог" доступна в любой момент
- [ ] AC 4: Переход на новый диалог не удаляет текущую сессию

**Notes**: Приветствие персонализировано — учитывает прошлые сессии, если они есть

---

### SS-010: Автогенерация названий сессий

**Как** система,
**я хочу** автоматически генерировать название сессии,
**чтобы** пользователь мог быстро найти нужный диалог.

**Acceptance Criteria:**
- [ ] AC 1: Название генерируется после первого ответа AI
- [ ] AC 2: Название отражает ключевую тему: вино, событие или блюдо
- [ ] AC 3: Примеры названий: "Вино к стейку", "Бордо на ДР", "Розовое для пикника"
- [ ] AC 4: Название не превышает 30 символов
- [ ] AC 5: Если тема неясна — используется дата ("3 февраля")

**Notes**: LLM генерирует название на основе первых сообщений

---

### SS-011: Cross-session контекст

**Как** система,
**я хочу** учитывать историю всех сессий пользователя при генерации рекомендаций,
**чтобы** предоставлять более персонализированный опыт.

**Acceptance Criteria:**
- [ ] AC 1: Система извлекает ключевые факты из прошлых сессий (понравившиеся вина, события)
- [ ] AC 2: Факты передаются в LLM как часть контекста пользователя
- [ ] AC 3: AI не повторяет одни и те же рекомендации в разных сессиях
- [ ] AC 4: AI может сослаться на прошлый опыт ("В прошлый раз вам понравилось...")

**Notes**: Долгосрочная персонализация через историю

---

### SS-012: Lifecycle сессий

**Как** система,
**я хочу** управлять жизненным циклом сессий,
**чтобы** обеспечить баланс между историей и приватностью.

**Acceptance Criteria:**
- [ ] AC 1: Сессия автоматически закрывается через 30 минут неактивности
- [ ] AC 2: Сессии хранятся минимум 90 дней
- [ ] AC 3: Пользователь может удалить отдельную сессию
- [ ] AC 4: При удалении аккаунта удаляются все сессии

**Notes**: Баланс между историей и приватностью

---

## Non-Functional Requirements

| Требование | Метрика | Target |
|------------|---------|--------|
| Загрузка списка сессий | p95 latency | < 200ms |
| Переключение сессии | p95 latency | < 300ms |
| Генерация названия | p95 latency | < 2s |
| Хранение сессий | Retention | 90 дней |
| Auto-close | Inactivity | 30 минут |
| Название сессии | Max length | 30 символов |

---

## Out of Scope

- Поиск по сессиям (v1.1)
- Экспорт сессий (v1.1)
- Шаринг сессий между пользователями
- Редактирование названий сессий вручную
- Архивирование сессий
- Продолжение закрытых сессий

---

## Dependencies

- US-001: Регистрация и авторизация (DONE)
- US-002: Chat интерфейс (DONE)
- SS-002: RAG для поиска вин (DONE)

---

## Risks

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| LLM naming fails | Средняя | Низкое | Fallback на дату |
| Большое количество сессий тормозит UI | Низкая | Среднее | Пагинация, lazy load |
| Cross-session context слишком большой | Средняя | Среднее | Лимит на количество фактов |
