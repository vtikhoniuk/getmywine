# Feature Specification: Chat Welcome & AI Greeting

**Feature Branch**: `002-chat-welcome`
**Created**: 2026-02-02
**Status**: Draft
**Input**: US-002: Приветствие и чат-интерфейс. При первом входе пользователь видит приветственное сообщение от AI-сомелье. AI объясняет свои возможности простым языком, предлагает начать с определения вкусовых предпочтений. Чат-интерфейс для общения с AI. Отображается возрастное ограничение 18+.

## User Scenarios & Testing *(mandatory)*

### User Story 1 - First Visit Welcome (Priority: P1)

Авторизованный пользователь впервые заходит в чат и видит приветственное сообщение от AI-сомелье. AI представляется, объясняет свои возможности и предлагает начать с определения вкусовых предпочтений.

**Why this priority**: Это первое впечатление пользователя от сервиса. Без приветствия пользователь не понимает, что делать дальше.

**Independent Test**: Можно протестировать, создав нового пользователя и проверив, что при первом входе в чат отображается приветственное сообщение.

**Acceptance Scenarios**:

1. **Given** пользователь авторизован и впервые открывает чат, **When** страница чата загружается, **Then** отображается приветственное сообщение от AI-сомелье
2. **Given** приветственное сообщение отображено, **When** пользователь читает его, **Then** сообщение содержит объяснение возможностей сервиса простым языком
3. **Given** приветственное сообщение отображено, **When** пользователь читает его, **Then** сообщение предлагает начать с определения вкусовых предпочтений

---

### User Story 2 - Chat Interface (Priority: P1)

Пользователь видит чат-интерфейс с полем ввода сообщений и историей переписки. Пользователь может отправить сообщение и получить ответ от AI.

**Why this priority**: Чат-интерфейс — основной способ взаимодействия с AI-сомелье. Без него невозможно использовать сервис.

**Independent Test**: Можно протестировать, отправив сообщение в чат и проверив, что AI отвечает.

**Acceptance Scenarios**:

1. **Given** пользователь находится на странице чата, **When** страница загружена, **Then** отображается поле ввода сообщения и кнопка отправки
2. **Given** пользователь ввёл сообщение в поле ввода, **When** нажимает кнопку отправки или Enter, **Then** сообщение отображается в истории чата
3. **Given** сообщение отправлено, **When** AI обрабатывает запрос, **Then** отображается индикатор загрузки
4. **Given** AI обработал запрос, **When** ответ готов, **Then** ответ отображается в истории чата

---

### User Story 3 - Age Restriction Display (Priority: P2)

На странице чата отображается информация о возрастном ограничении 18+.

**Why this priority**: Юридическое требование для сервиса, связанного с алкоголем. Менее критично, так как возраст уже подтверждён при регистрации.

**Independent Test**: Можно проверить наличие предупреждения 18+ на странице чата.

**Acceptance Scenarios**:

1. **Given** пользователь находится на странице чата, **When** страница загружена, **Then** видно предупреждение о возрастном ограничении 18+

---

### User Story 4 - Returning User (Priority: P2)

Пользователь, который уже общался с AI ранее, видит историю предыдущих сообщений при повторном входе в чат.

**Why this priority**: Улучшает пользовательский опыт, но не блокирует основную функциональность.

**Independent Test**: Можно проверить, отправив сообщения, выйдя и зайдя снова — история должна сохраниться.

**Acceptance Scenarios**:

1. **Given** пользователь ранее общался с AI, **When** открывает чат повторно, **Then** отображается история предыдущих сообщений
2. **Given** пользователь видит историю, **When** прокручивает вверх, **Then** может просмотреть более ранние сообщения

---

### Edge Cases

- Что происходит, если AI не отвечает в течение 30 секунд? → Показать сообщение об ошибке и предложить повторить
- Что происходит при потере соединения во время отправки? → Показать ошибку, сохранить текст сообщения в поле ввода
- Что происходит, если пользователь отправляет пустое сообщение? → Кнопка отправки неактивна при пустом поле
- Что происходит при очень длинном сообщении? → Ограничить длину (например, 2000 символов)

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: Система ДОЛЖНА отображать страницу чата для авторизованных пользователей
- **FR-002**: Система ДОЛЖНА показывать приветственное сообщение при первом визите пользователя в чат
- **FR-003**: Приветственное сообщение ДОЛЖНО объяснять возможности AI-сомелье простым языком
- **FR-004**: Приветственное сообщение ДОЛЖНО предлагать начать с определения вкусовых предпочтений
- **FR-005**: Система ДОЛЖНА предоставлять поле ввода для отправки сообщений AI
- **FR-006**: Система ДОЛЖНА отображать отправленные сообщения пользователя в истории чата
- **FR-007**: Система ДОЛЖНА отправлять сообщения пользователя AI-сервису и получать ответы
- **FR-008**: Система ДОЛЖНА отображать ответы AI в истории чата
- **FR-009**: Система ДОЛЖНА показывать индикатор загрузки пока AI формирует ответ
- **FR-010**: Система ДОЛЖНА сохранять историю сообщений для каждого пользователя
- **FR-011**: Система ДОЛЖНА отображать предупреждение о возрастном ограничении 18+
- **FR-012**: Неавторизованные пользователи ДОЛЖНЫ быть перенаправлены на страницу входа

### Key Entities

- **Message**: Сообщение в чате. Атрибуты: отправитель (пользователь/AI), текст, время отправки
- **Conversation**: Диалог пользователя с AI. Связан с пользователем, содержит список сообщений
- **User**: Существующая сущность из US-001. Связан с диалогами

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 100% новых пользователей видят приветственное сообщение при первом входе в чат
- **SC-002**: Пользователь может отправить сообщение и получить ответ от AI за менее чем 10 секунд (при нормальной нагрузке)
- **SC-003**: История сообщений сохраняется и отображается при повторном входе в 100% случаев
- **SC-004**: Предупреждение 18+ видно на странице чата без необходимости прокрутки

## Assumptions

- AI-сервис для генерации ответов будет реализован как заглушка (mock) на первом этапе
- Приветственное сообщение будет статичным текстом (не генерируется AI динамически)
- История сообщений хранится бессрочно
- Максимальная длина сообщения пользователя: 2000 символов

## Out of Scope

- Интеграция с реальным LLM (Claude, GPT) — будет в следующей итерации
- Опрос о вкусовых предпочтениях (US-005) — отдельная фича
- Рекомендации вин (US-008) — отдельная фича
- Голосовой ввод
- Прикрепление изображений
