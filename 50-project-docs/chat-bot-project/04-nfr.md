# Нефункциональные требования (NFR)

> **Проект:** NutriBot
> **Дата:** 2026-01-30
> **Домен:** HealthTech / Wellness
> **Версия:** 1.0

---

## 1. Производительность (Performance Efficiency)

### 1.1 Профиль нагрузки

| Метрика | MVP | Через 6 месяцев | Через 1 год |
|---------|-----|-----------------|-------------|
| **DAU (клиенты)** | 50 | 200 | 500 |
| **Нутрициологов** | 5 | 20 | 50 |
| **Одновременных сессий (пик)** | 20 | 80 | 200 |

### 1.2 Пропускная способность (Throughput)

- **Telegram webhook:** до 30 сообщений/сек (лимит Telegram API)
- **API запросы:** 10-50 RPS (средняя нагрузка), до 100 RPS (пик)
- **LLM запросы:** 5-10 запросов/мин (ограничение по стоимости)

### 1.3 Время отклика (Latency)

| Операция | Target (p95) | Примечание |
|----------|--------------|------------|
| Ответ бота на сообщение | < 2 сек | Без LLM-обработки |
| LLM-генерация ответа | < 10 сек | С учётом API Claude/GPT |
| Загрузка страницы веб-панели | < 3 сек | LCP |
| OCR обработка анализов | < 30 сек | Асинхронно |
| Генерация PDF отчёта | < 15 сек | Асинхронно |

---

## 2. Надёжность (Reliability)

### 2.1 Доступность (Availability)

- **SLA:** 99.5%
- **Допустимый простой:** до 44 часов/год
- **Плановое окно обслуживания:** Ночь выходных (02:00-06:00 MSK)

**Обоснование:** Не критичная для жизни система, бизнес-контекст допускает небольшие простои.

### 2.2 Целостность данных (RPO — Recovery Point Objective)

- **Максимально допустимая потеря данных:** 1 час
- **Перевод:** Если всё упадёт, мы можем потерять данные максимум за последний час

### 2.3 Скорость восстановления (RTO — Recovery Time Objective)

- **Время на восстановление:** 4 часа
- **Перевод:** После аварии система должна заработать за 4 часа

---

## 3. Безопасность (Security)

### 3.1 Регуляторные требования (Compliance)

- [x] **152-ФЗ** (персональные данные РФ) — данные хранятся в РФ
- [ ] GDPR — не применимо (только российские пользователи)
- [ ] PCI DSS — не применимо (нет обработки платежей)
- [ ] HIPAA — не применимо (не медицинское учреждение)

**Важно:** Бот не ставит диагнозы и не даёт медицинских назначений. Все рекомендации носят информационный характер.

### 3.2 Классификация данных

| Категория | Примеры | Уровень защиты |
|-----------|---------|----------------|
| Персональные данные | ФИО, возраст, контакты | Стандартный (152-ФЗ) |
| Данные о здоровье | Анамнез, анализы | Повышенный |
| Аутентификация | Пароли, токены | Криптографический |

### 3.3 Аутентификация и авторизация

**Telegram-бот (клиенты):**
- Аутентификация через Telegram ID
- Привязка к нутрициологу через referral-код

**Веб-панель (нутрициологи):**
- Вход по email/паролю
- Опционально: OAuth (Google, Yandex)
- Сессия: 24 часа, logout при неактивности 2 часа

**Парольная политика:**
- Минимум 8 символов
- Буквы + цифры
- Rate limiting: 5 попыток / 15 минут

### 3.4 Локализация данных

- **Обязательно:** Хранение в РФ (Yandex Cloud)
- **LLM API:** Данные передаются в Anthropic/OpenAI для обработки
  - Используется только для генерации, не для обучения
  - Персональные данные минимизируются в промптах

---

## 4. Масштабируемость (Scalability)

### 4.1 Ожидаемый рост

| Период | Нутрициологов | Клиентов (активных) | Данных |
|--------|---------------|---------------------|--------|
| MVP | 5 | 50 | < 1 GB |
| 6 месяцев | 20 | 200 | 5 GB |
| 1 год | 50 | 500 | 20 GB |
| 3 года | 200 | 2000 | 100 GB |

### 4.2 Требования к масштабированию

- **Горизонтальное:** Опционально на этапе MVP
- **Вертикальное:** Достаточно для первых 6 месяцев
- **Bottleneck:** LLM API (стоимость и rate limits)

---

## 5. Сопровождаемость (Maintainability)

### 5.1 Команда поддержки

- **Кто поддерживает:** 1 full-stack разработчик (автор)
- **Компетенции:** Python/Node.js, PostgreSQL, Telegram Bot API
- **Режим работы:** По запросу (не 24x7)

### 5.2 Деплоймент

- **Частота обновлений:** 1-2 раза в неделю
- **Допустимый даунтайм при деплое:** до 5 минут
- **Откат:** Ручной через git revert

### 5.3 Технический долг

- Code review для критичных изменений
- Покрытие тестами > 60% (критические пути)
- Документация API в Swagger/OpenAPI

---

## 6. Наблюдаемость (Observability)

### 6.1 Мониторинг

**Ключевые метрики:**
- Uptime (health checks каждые 30 сек)
- Response time (p50, p95, p99)
- Error rate (4xx, 5xx)
- LLM API usage и стоимость
- Telegram webhook latency

**Алерты:**
- Error rate > 5% → Telegram нутрициологу-owner
- API down > 5 мин → Email + SMS

**Дашборды:**
- Основные метрики в Yandex Monitoring

### 6.2 Логирование

- **Уровень детализации:** Стандартный (INFO + ERROR)
- **Срок хранения логов:** 30 дней
- **Audit trail:** Для доступа к данным клиентов

**Что логируем:**
- Все запросы к API (без sensitive данных)
- Ошибки с stack trace
- Действия пользователей (auth, CRUD)

---

## 7. Совместимость (Compatibility)

### 7.1 Клиентские устройства

**Telegram-бот:**
- Telegram iOS/Android/Desktop/Web
- Все актуальные версии

**Веб-панель:**
- Chrome 100+
- Safari 15+
- Firefox 100+
- Edge 100+
- Mobile: адаптивный дизайн (responsive)

### 7.2 Сеть

- **Доступ:** Публичный интернет
- **Офлайн-режим:** Не поддерживается
- **Минимальная скорость:** 1 Mbps

### 7.3 Интеграции

| Система | Тип | Протокол | Критичность |
|---------|-----|----------|-------------|
| Telegram Bot API | Webhook | HTTPS/JSON | Критическая |
| Claude/GPT API | REST | HTTPS/JSON | Критическая |
| OCR сервис | REST | HTTPS/JSON | Высокая |
| Email (SMTP) | SMTP | TLS | Средняя |

---

## 8. Жизненный цикл данных (Data Lifecycle)

### 8.1 Хранение

- **Срок хранения активных данных:** Бессрочно (пока клиент активен)
- **Архивация:** Не требуется для MVP

### 8.2 Удаление

- **Право на удаление:** Да (по запросу клиента)
- **Процедура:** Ручное удаление админом + автоматическое из бэкапов через 30 дней
- **Soft delete:** Да, для всех пользовательских данных

### 8.3 Резервное копирование

- **Частота:** Ежедневно (ночью)
- **Глубина хранения:** 30 дней
- **Тип:** Полный бэкап PostgreSQL + файловое хранилище

---

## 9. Интернационализация (i18n)

- **Языки интерфейса:** Только русский (MVP)
- **Часовые пояса:** Московское время (MSK) по умолчанию
- **Валюты:** Не применимо (нет платежей)
- **Форматы дат:** DD.MM.YYYY

---

## 10. Доступность (Accessibility)

- **Стандарт:** Нет формальных требований для MVP
- **Базовые принципы:**
  - Контрастный текст
  - Читаемые шрифты (16px+)
  - Поддержка клавиатурной навигации в веб-панели

---

## [Сводка аналитика]

### Главные вызовы

1. **Баланс стоимости LLM и качества:** Каждый запрос к Claude/GPT стоит денег. Нужно оптимизировать промпты и кэшировать где возможно.

2. **OCR анализов:** Разнообразие форматов лабораторий — главный технический риск. Необходим fallback на ручной ввод.

3. **Персональные данные в LLM:** Минимизировать передачу sensitive данных. Использовать псевдонимизацию.

### Серые зоны

- **Точные требования к OCR:** Какие лаборатории наиболее популярны? Какие форматы приоритетны?
- **Рост нагрузки:** Если нутрициологов станет 100+, нужен пересмотр архитектуры.
- **Retention данных:** Как долго хранить данные неактивных клиентов?

### Рекомендации

1. **Начать с минимального OCR:** Поддержка 2-3 крупнейших лабораторий (Инвитро, Гемотест, Хеликс)
2. **Мониторинг стоимости LLM:** Дашборд с cost per request, алерты при превышении бюджета
3. **A/B тестирование промптов:** Оптимизация качества и стоимости генерации
4. **Юридическая консультация:** Проверка соответствия 152-ФЗ перед запуском
